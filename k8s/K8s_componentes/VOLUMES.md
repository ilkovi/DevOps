
### Types of Volumes

* NODE LOCAL 			- empty dir or host path
* Generic Networked Volumes	- nfs, glusterfs or cepthfs
* Coud provider 		- awsElasticBlockStore, AzureDisk, gcePersitentDisk
* Special-purpose volumes 	- secret gitRepo



#### Persistent Volume

NOTE
Remember that PVs are cluster-wide resources
PVCs are namespaced



1. STORAGE CLASS
(This specific storage class is using a storage provisioner 
that creates persistent volumes of type hostPath)

$ kubectl get storageclass
NAME                 PROVISIONER
standard (default)   k8s.io/minikube-hostpath


2. PersistentVolumeClaim
(minikube automatically mount it to default storage class)
Claims must exist in the same namespace as the pod using the claim. 
The cluster finds the claim in the pod’s namespace and uses it to 
get the PersistentVolume backing the claim. The volume is then mounted
 to the host and into the pod.


kind:          PersistentVolumeClaim
apiVersion:    v1
metadata:
  name:        data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi


3. Volume in the POD
...
  containers:
  - image:         mysql:5.5
    name:          db
    volumeMounts:
    - mountPath:   /var/lib/mysql
      name:        data
    env:
      - name:      MYSQL_ROOT_PASSWORD
        value:     root
  volumes:
  - name:          data
    persistentVolumeClaim:
      claimName:   data












### STorage Class


kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: standard
provisioner: kubernetes.io/aws-ebs	* Storage classes have a provisioner that determines what volume plugin is used for provisioning PVs
parameters:				* describe volumes belonging to the storage class
  type: gp2
reclaimPolicy: Retain			* reclaim policy specified Delete or Retain
mountOptions:				* options specified in the 
  - debug				    * If the storage plugin do not support them. Creation will fail
volumeBindingMode: Immediate		* The volumeBindingMode field controls when volume binding and dynamic provisioning should occur.


Provisioner?
- AWSElasticBlockStore
- AzureFile
- VsphereVolume
- Glusterfs

parameters
* type: 
	io1 - ssd highest performance
	gp2 - ssd balanced price and performance
	sc1 - Cold HDD, lowest cost 
	st1 - Troughput HDD, low cost
* iopsPerGB
	"10" - string is expected 
 (specific for AWS EBS)	
  only for io1 volumes 
  20 000 IOPS (maximum supported 
* fsType
	ext4
* encrypted
	"true"
	"false"
* kmsKeyId: optional - key to use when encrypting the volume
	If none is supplied but encrypted is true, a key is generated by AWS

volumeBindingMode
- Immediate	= volume binding and dynamic provisioning occurs once the PersistentVolumeClaim is created
- WaitForFirstConsumer = delay the binding and provisioning of a PersistentVolume until a Pod using the PersistentVolumeClaim is created
  (AWSElasticBlockStore , GCEPersistentDisk ,AzureDisk )







` NOTE
To enable support for restoring a volume from a volume snapshot data source, enable the VolumeSnapshotDataSource feature gate on the apiserver and controller-manager